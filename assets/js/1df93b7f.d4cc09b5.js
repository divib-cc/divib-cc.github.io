"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[4583],{919:(t,e,n)=>{n.r(e),n.d(e,{default:()=>lt});var s=n(4164),r=n(6289),o=n(797),i=n(1410),a=n(9303);const c={heroBanner:"heroBanner_qdFl",buttons:"buttons_AeoN"};var u=n(6540),h=n(4922),l=n(9437),d=n(7024);var f=n(4667),w=n(8509);var p=n(9070);function m(t,e){const n=t.getUint16(e.n,!0);return e.n+=2,n}function _(t,e){const n=t.getUint32(e.n,!0);return e.n+=4,n}function b(t,e){const n=t.getFloat32(e.n,!0);return e.n+=4,n}function x(t,e){const n=t.getInt8(e.n);return e.n+=1,n}function g(t,e){const n=t.getInt16(e.n,!0);return e.n+=2,n}function y(t,e){const n=t.getInt32(e.n,!0);return e.n+=4,n}class A{constructor(t,e){this.x=b(t,e),this.y=b(t,e)}}class v{constructor(t,e){this.x=b(t,e),this.y=b(t,e),this.z=b(t,e)}}class E{col=[];constructor(t,e){for(let n=0;n<16;n++)this.col.push(b(t,e))}}class k{constructor(t,e){this.r=b(t,e),this.g=b(t,e),this.b=b(t,e),this.a=b(t,e)}}class M{constructor(t,e){this.b=x(t,e),this.g=x(t,e),this.r=x(t,e),this.a=x(t,e)}}class R{constructor(t,e){this.length=m(t,e),this.text=((t,e,n)=>{const s=new Uint8Array(t.buffer,e.n,n);return e.n+=n,(new TextDecoder).decode(s).replace(/\0.*$/g,"")})(t,e,this.length)}}let T=function(t){return t[t.MATERIAL=1095172609]="MATERIAL",t[t.MESH=1095172610]="MESH",t[t.ARMATURE=1095172611]="ARMATURE",t[t.ANIMATION=1095172612]="ANIMATION",t[t.INFLUENCE=1095172613]="INFLUENCE",t[t.MT2=547586304]="MT2",t}({});class z{constructor(t){const e={n:0},n=t.byteLength;this.header=new N(t,e);do{switch(_(t,e)){case T.MATERIAL:this.mt=new I(t,e);break;case T.ARMATURE:this.sk=new P(t,e);break;case T.MESH:this.ge=new B(t,e,this.sk.count);break;case T.ANIMATION:this.an=new F(t,e);break;default:e.n-=4,this.gl=new Y(t,e)}}while(n-e.n>4)}}class N{constructor(t,e){this.magic=_(t,e),this.fileVersion=m(t,e);const n=function(t,e){const n=t.getUint8(e.n);return e.n+=1,n}(t,e);this.model_flag=new j(n),this.alpha_threshold=x(t,e),this.unkus1=m(t,e),this.bound_min=new v(t,e),this.bound_max=new v(t,e),this.scale_percentage=_(t,e)}}class j{constructor(t){this.unk_bit1=!!(128&t),this.unk_bit2=!!(64&t),this.additive_blend=!!(32&t),this.unk_bit3=!!(16&t),this.unk_bit4=!!(8&t),this.unk_bit5=!!(4&t),this.unk_bit6=!!(2&t),this.enable_alpha=!!(1&t)}}class I{materials=[];constructor(t,e){this.count=m(t,e);for(let n=0;n<this.count;n++)this.materials.push(new L(t,e))}}class L{constructor(t,e){this.material_properties=new W(t,e),this.texture=new S(t,e),this.layer=new U(t,e)}}class W{constructor(t,e){this.diffuse=new k(t,e),this.ambient=new k(t,e),this.specular=new k(t,e),this.emissive=new k(t,e),this.power=b(t,e)}}class S{constructor(t,e){this.id=new R(t,e),this.size=y(t,e),this.data=((t,e,n)=>{const s=new Uint8Array(t.buffer,e.n,n);return e.n+=n,s})(t,e,this.size),this.is_faceted=!!x(t,e),this.scroll_speed=new A(t,e)}}class U{constructor(t,e){this.material_index=y(t,e),this.is_faceted=!!x(t,e),this.scroll_speed=new A(t,e),this.render_flags=y(t,e)}}class P{bones=[];constructor(t,e){this.count=m(t,e);for(let n=0;n<this.count;n++)this.bones.push(new q(t,e))}}class q{constructor(t,e){this.id=new R(t,e),this.parent_bone_index=y(t,e),this.bone_space_matrix=new E(t,e),this.parent_bone_space_matrix=new E(t,e)}}class B{meshes=[];constructor(t,e,n){this.count=m(t,e);for(let s=0;s<this.count;s++)this.meshes.push(new D(t,e,n))}}class D{positions=[];normals=[];uvs=[];faces=[];influences=[];constructor(t,e,n){this.id=new R(t,e),this.world_matrix=new E(t,e),this.local_matrix=new E(t,e),this.root_bone_id=y(t,e),this.material_index=x(t,e),this.vertex_count=g(t,e),this.face_count=g(t,e);for(let s=0;s<this.vertex_count;s++){for(let n=0;n<3;n++)this.positions.push(b(t,e));for(let n=0;n<3;n++)this.normals.push(b(t,e));for(let n=0;n<2;n++)this.uvs.push(b(t,e))}for(let s=0;s<3*this.face_count;s++)this.faces.push(m(t,e));this.chunk_id=_(t,e),this.influence_count=g(t,e);for(let s=0;s<this.influence_count;s++)this.influences.push(new C(t,e,n))}}class C{influence_for_bone=[];constructor(t,e,n){for(let s=0;s<n;s++)this.influence_for_bone.push(new H(t,e))}}class H{vertex_index=[];weight=[];constructor(t,e){this.count=y(t,e);for(let n=0;n<this.count;n++)this.vertex_index.push(y(t,e));for(let n=0;n<this.count;n++)this.weight.push(b(t,e))}}class F{animations=[];constructor(t,e){this.count=m(t,e);for(let n=0;n<this.count;n++)this.animations.push(new $(t,e))}}class ${transformations=[];constructor(t,e){this.id=new R(t,e),this.count=m(t,e);for(let n=0;n<this.count;n++)this.transformations.push(new O(t,e))}}class O{translations=[];rotations=[];constructor(t,e){this.id=new R(t,e),this.translation_count=_(t,e);for(let n=0;n<this.translation_count;n++)this.translations.push(new V(t,e));this.rotation_count=_(t,e);for(let n=0;n<this.rotation_count;n++)this.rotations.push(new J(t,e))}}class V{constructor(t,e){this.keyframe_second=b(t,e),this.position=new v(t,e)}}class J{constructor(t,e){this.keyframe_second=b(t,e),this.rotation=new K(t,e)}}class K{constructor(t,e){this.x=b(t,e),this.y=b(t,e),this.z=b(t,e),this.w=b(t,e)}}class Y{glow_colour=[];constructor(t,e){for(;t.byteLength-e.n>=4;)this.glow_colour.push(new M(t,e))}}const Z=257283;class Q{constructor(t){void 0===t&&(t=h.h_9),this.manager=t,this.fileLoader=new h.Y9S(t),this.fileLoader.setResponseType("arraybuffer")}load(t,e,n,s){this.fileLoader.load(t,(t=>{if(t instanceof ArrayBuffer)try{const n=this.parse(t);e(n)}catch(n){s?.(n)}else s?.(new Error("Invalid binary data"))}),n,s)}parse(t){const e=new DataView(t),n=new z(e);return this.reader(n)}reader(t){const e=new h.YJl,n=et(t),s=G(t),r=X(t,n,s);e.add(...r);const o=st(t,s);return e.animations=o,e}}const G=t=>{const e=[];return t.sk.bones.forEach((t=>{const{id:n,parent_bone_index:s,bone_space_matrix:r,parent_bone_space_matrix:o}=t,i=new h.$Kf;i.name=n.text;const a=(new h.kn4).fromArray(r.col).invert();if(i.matrix.copy(a),-1!==s){const t=(new h.kn4).fromArray(o.col).invert().multiply(a);i.matrix.copy(t),e[s].add(i)}i.matrix.decompose(i.position,i.quaternion,i.scale),e.push(i)})),new h.EAD(e)},X=(t,e,n)=>t.ge.meshes.map((t=>{const{id:s,positions:r,normals:o,uvs:i,faces:a,influence_count:c,influences:u,material_index:l}=t,d=new h.LoY;let f;return d.setAttribute("position",new h.qtW(r,3)),d.setAttribute("normal",new h.qtW(o,3)),d.setAttribute("uv",new h.qtW(i,2)),d.setIndex(a),0===c?f=new h.eaF(d,e[l]):(f=new h.I46(d,e[l]),tt(f,u,n)),f.name=s.text,f})),tt=(t,e,n)=>{const s=n.bones.filter((t=>!(t.parent instanceof h.$Kf)));t.add(...s),t.bind(n);const r=[],o=[];e.forEach(((t,e)=>{t.influence_for_bone.forEach(((t,e)=>{t.vertex_index.forEach(((n,s)=>{const i=t.weight[s];r[n]||(r[n]=[],o[n]=[]),r[n].length<4&&(r[n].push(e),o[n].push(i))}))}))}));for(let i=0;i<r.length;i++)if(r[i].length<4)for(;r[i].length<4;)r[i].push(0),o[i].push(0);t.geometry.setAttribute("skinIndex",new h.A$4(r.flat(),4)),t.geometry.setAttribute("skinWeight",new h.qtW(o.flat(),4))},et=t=>{const{materials:e}=t.mt;return e.map((t=>{const{diffuse:e,ambient:n,specular:s,emissive:r,power:o}=t.material_properties,i=nt(t.texture.data);return new h.V9B({name:t.texture.id.text,map:i,side:h.$EB,color:new h.Q1f(e.b,e.g,e.r),opacity:e.a,transparent:e.a<1,combine:h.KRh,reflectivity:s.a,alphaTest:.01})}))},nt=t=>{const e=new p.T;try{const n=new Blob([t],{type:"image/dds"}),s=URL.createObjectURL(n);return e.load(s,(()=>URL.revokeObjectURL(s)))}catch(n){return console.error("DDS\u52a0\u8f7d\u5931\u8d25:",n),new h.gPd}},st=(t,e)=>{const n=t.header.magic;return t.an.animations.map((t=>{const s=[];return t.transformations.forEach((t=>{const{id:r,translations:o,rotations:i}=t,a=e.bones.find((t=>t.name===r.text));if(!a)return;const c=a.parent?.matrixWorld||new h.kn4,u=new h.Pq0,l=new h.PTz,d=new h.Pq0;c.decompose(u,l,d);const f=rt(t.translations,a.name,c,n);f&&s.push(f);const w=ot(t.rotations,a.name,l,n);w&&s.push(w)})),new h.tz3(t.id.text,-1,s)}))},rt=(t,e,n,s)=>{const r=t.map((t=>t.keyframe_second)),o=t.flatMap((t=>{const e=new h.Pq0(t.position.x,t.position.y,t.position.z);if(s===Z)return[e.x,e.y,e.z];{const t=e.applyMatrix4(n.clone().invert());return[t.x,t.y,t.z]}}));return new h.RiT(`${e}.position`,r,o)},ot=(t,e,n,s)=>{const r=t.map((t=>t.keyframe_second)),o=t.flatMap((t=>{const e=new h.PTz(t.rotation.x,t.rotation.y,t.rotation.z,t.rotation.w).conjugate();return s===Z?e.toArray():n.clone().conjugate().multiply(e).toArray()}));return new h.MBL(`${e}.quaternion`,r,o)};var it=n(5363),at=n(4848);const ct=()=>{const[t,e]=(0,u.useState)(1/60),n=(0,u.useRef)(t);(0,u.useEffect)((()=>{n.current=t}),[t]);const s=(0,u.useRef)(null),r=(0,u.useRef)(null),o=(0,u.useRef)(null),i=(0,u.useRef)([]),a=(0,u.useRef)([]),c=(0,u.useRef)([]),p=(0,u.useRef)([]),m=(0,u.useRef)([]),_=(0,u.useCallback)((()=>{i.current.forEach(((t,n)=>{const s=c.current[n];if(!t||!s||!s.pressed)return;const r=p.current[n],o=s.pressed,i=t.clipAction(o);r!==i&&(i.reset(),i.enabled=!0,i.setEffectiveWeight(0),i.play(),i.setLoop(h.aMy,1/0),m.current.push({mixer:t,oldAction:r,newAction:i,startTime:performance.now(),duration:.1}),p.current[n]=i,e(.1))}))}),[]),b=(0,u.useCallback)((()=>{i.current.forEach(((t,n)=>{const s=c.current[n];if(!t||!s||!s.default)return;const r=p.current[n],o=s.default,i=t.clipAction(o);r!==i&&(i.reset(),i.enabled=!0,i.setEffectiveWeight(0),i.play(),i.setLoop(h.aMy,1/0),m.current.push({mixer:t,oldAction:r,newAction:i,startTime:performance.now(),duration:.2}),p.current[n]=i,e(1/30))}))}),[]);return(0,u.useEffect)((()=>{if(!s.current)return;const{scene:t,camera:e,renderer:u,controls:_,dispose:b}=(t=>{const e=new h.Z58;e.background=new h.Q1f(14737632);const n=new h.ubm(55,window.innerWidth/window.innerHeight,1,2e3);n.position.set(0,200,500);const s=new l.JeP({canvas:t});s.setSize(window.innerWidth,window.innerHeight),s.toneMapping=h.FV,s.toneMappingExposure=.5;const r=new d.N(n,t),o=()=>{n.aspect=window.innerWidth/window.innerHeight,n.updateProjectionMatrix(),s.setSize(window.innerWidth,window.innerHeight)};return window.addEventListener("resize",o),{scene:e,camera:n,renderer:s,controls:r,dispose:()=>{window.removeEventListener("resize",o),s.dispose()}}})(s.current);o.current=((t,e)=>{const n={elevation:2,azimuth:180},s=new h.bdM(1e4,1e4),r=new f.E(s,{textureWidth:512,textureHeight:512,waterNormals:(new h.Tap).load("three/waternormals.jpg",(t=>{t.wrapS=t.wrapT=h.GJx})),sunDirection:new h.Pq0,sunColor:16777215,waterColor:7695,distortionScale:3.7,fog:void 0!==t.fog});r.rotation.x=-Math.PI/2,t.add(r);const o=new w.m;o.scale.setScalar(1e4),t.add(o);const i=new l.BdL(e),a=new h.Z58;let c=null;const u=()=>{const e=h.cj9.degToRad(90-n.elevation),s=h.cj9.degToRad(n.azimuth),u=(new h.Pq0).setFromSphericalCoords(1,e,s);o.material.uniforms.sunPosition.value.copy(u),r.material.uniforms.sunDirection.value.copy(u).normalize(),c&&c.dispose(),a.add(o),c=i.fromScene(a),t.add(o),t.environment=c.texture},d=new h.dth(16777215,9276813,3);d.position.set(0,20,0),t.add(d);const p=new h.ZyN(16777215,3);return p.position.set(0,20,10),t.add(p),u(),{water:r,sky:o,updateSun:u,parameters:n}})(t,u);const x=new Q,g=e=>new Promise((n=>{x.load(e,(e=>{t.add(e),n(e)}))}));Promise.all([g("./three/bike12.ebm"),g("./three/z6.ech")]).then((t=>{let[e,n]=t;a.current=[e,n],e.rotation.y=180,n.rotation.y=180;const s=new h.Iw4(e),r=new h.Iw4(n);i.current=[s,r];const o=h.tz3.findByName(e.animations,"idle"),u=h.tz3.findByName(e.animations,"move"),l=h.tz3.findByName(n.animations,"ride__sp00"),d=h.tz3.findByName(n.animations,"ride__sp01");if(c.current=[{default:o,pressed:u},{default:l,pressed:d}],p.current=[],o){const t=s.clipAction(o);t.play(),p.current[0]=t}if(l){const t=r.clipAction(l);t.play(),p.current[1]=t}}));const y=new h.zD7,A=()=>{const s=y.getDelta(),a=performance.now();if(m.current=m.current.filter((t=>{const{mixer:e,oldAction:n,newAction:s,startTime:r,duration:o}=t,i=(a-r)/1e3;if(i>=o)return n.enabled=!1,s.setEffectiveWeight(1),!1;const c=i/o;return n.setEffectiveWeight(1-c),s.setEffectiveWeight(c),!0})),requestAnimationFrame(A),_.update(),i.current.forEach((t=>t.update(s))),o.current){o.current.water.material.uniforms.time.value+=n.current}r.current?.update(s),u.render(t,e)};return A(),()=>{m.current=[],p.current=[],i.current.forEach((t=>t.stopAllAction())),a.current.forEach((e=>t.remove(e))),i.current=[],b(),o.current?.updateSun()}}),[]),(0,at.jsx)("canvas",{ref:s,style:{width:"100%",height:"100vh"},onMouseDown:_,onMouseUp:b})},ut=()=>(0,at.jsx)("div",{style:{width:"100%",height:"100vh"},children:(0,at.jsx)(it.A,{children:()=>(0,at.jsx)(ct,{})})});function ht(){const{siteConfig:t}=(0,o.A)();return(0,at.jsx)("header",{className:(0,s.A)("hero hero--primary",c.heroBanner),children:(0,at.jsxs)("div",{className:"container",children:[(0,at.jsx)(a.A,{as:"h1",className:"hero__title",children:t.title}),(0,at.jsx)("p",{className:"hero__subtitle",children:t.tagline}),(0,at.jsx)("div",{className:c.buttons,children:(0,at.jsx)(r.A,{className:"button button--secondary button--lg",to:"/docs/intro",children:"Docusaurus Tutorial - 5min \u23f1\ufe0f"})})]})})}function lt(){const{siteConfig:t}=(0,o.A)();return(0,at.jsxs)(i.A,{title:`Hello from ${t.title}`,description:"Description will go into a meta tag in <head />",children:[(0,at.jsx)(ht,{}),(0,at.jsx)("main",{style:{height:"720px"},children:(0,at.jsx)(ut,{})})]})}}}]);